<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PRIMA CRM</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* === ДИЗАЙН (Dark/Gold) === */
        :root {
            --bg-color: #000000;
            --card-bg: #18181b; /* Zinc-900 */
            --border-color: #27272a; /* Zinc-800 */
            --accent: #eab308; /* Yellow-500 */
            --text-main: #ffffff;
            --text-sec: #a1a1aa;
        }

        body { background-color: var(--bg-color); color: var(--text-main); font-family: -apple-system, sans-serif; height: 100vh; display: flex; justify-content: center; overflow: hidden; margin: 0; }
        
        #app { width: 100%; max-width: 480px; background-color: #09090b; display: flex; flex-direction: column; position: relative; border-left: 1px solid #222; border-right: 1px solid #222; }

        /* Скролл */
        .content { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 100px; display: none; }
        .content.active { display: block; animation: fadeIn 0.3s; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Карточки */
        .card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 16px; padding: 16px; margin-bottom: 12px; }
        .glass { background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); }

        /* Кнопки сайтов */
        .grid-sites { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 20px; }
        .site-btn {
            background: #111; border: 1px solid var(--border-color); border-radius: 12px; height: 70px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; position: relative;
        }
        .site-btn.active { border-color: var(--accent); background: #222; box-shadow: inset 0 0 15px rgba(234, 179, 8, 0.1); }
        .site-btn h2 { margin: 0; font-size: 20px; font-weight: 900; }
        .site-btn span { font-size: 9px; text-transform: uppercase; color: #666; font-weight: bold; margin-top: 2px; }
        .check-dot { position: absolute; top: 8px; right: 8px; width: 6px; height: 6px; background: var(--accent); border-radius: 50%; display: none; box-shadow: 0 0 5px var(--accent); }
        .site-btn.active .check-dot { display: block; }

        /* Основные кнопки */
        .btn-main {
            width: 100%; padding: 18px; border-radius: 12px; border: none; font-weight: 900; font-size: 14px;
            text-transform: uppercase; cursor: pointer; letter-spacing: 1px; transition: transform 0.1s;
            display: flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-main:active { transform: scale(0.97); }
        .bg-yellow { background: var(--accent); color: black; box-shadow: 0 0 20px rgba(234, 179, 8, 0.2); }
        .bg-red { background: #dc2626; color: white; box-shadow: 0 0 20px rgba(220, 38, 38, 0.2); }

        /* Инпуты */
        input { background: #000; border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; width: 100%; outline: none; transition: 0.2s; }
        input:focus { border-color: var(--accent); }

        /* Меню */
        .nav-bar {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: #09090b; border-top: 1px solid var(--border-color);
            display: flex; justify-content: space-around; padding: 12px 0; z-index: 50;
        }
        .nav-item { background: none; border: none; color: #52525b; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 10px; font-weight: bold; cursor: pointer; }
        .nav-item.active { color: var(--accent); }
        .nav-item svg { width: 22px; height: 22px; }

        /* Модальное окно */
        .modal-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .modal-overlay.open { opacity: 1; pointer-events: all; }
        .modal-content { background: #18181b; padding: 24px; border-radius: 20px; width: 85%; max-width: 350px; border: 1px solid #333; text-align: center; transform: scale(0.9); transition: 0.3s; }
        .modal-overlay.open .modal-content { transform: scale(1); }

    </style>
</head>
<body>

<div id="app">

    <div id="tab-studio" class="content active no-scrollbar">
        <div class="card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div style="display: flex; gap: 12px; align-items: center;">
                <div style="width: 42px; height: 42px; background: #27272a; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 800; border: 1px solid #3f3f46;">K</div>
                <div>
                    <div style="font-weight: 800; font-size: 16px; letter-spacing: 0.5px;">PRIMA</div>
                    <div style="font-size: 11px; color: #71717a;">Панель оператора</div>
                </div>
            </div>
            <div style="text-align: right;">
                <div style="font-size: 10px; color: #71717a;">БАЛАНС</div>
                <div style="color: #4ade80; font-weight: 900; font-size: 18px;">$ <span id="balance-display">0</span></div>
            </div>
        </div>

        <div id="view-pre-shift">
            <div class="grid-sites">
                <div class="site-btn active" onclick="toggleSite(this)">
                    <div class="check-dot"></div><h2 style="color: #eab308">C</h2><span>Chaturbate</span>
                </div>
                <div class="site-btn active" onclick="toggleSite(this)">
                    <div class="check-dot"></div><h2 style="color: #ef4444">S</h2><span>Stripchat</span>
                </div>
                <div class="site-btn" onclick="toggleSite(this)">
                    <div class="check-dot"></div><h2 style="color: #3b82f6">C</h2><span>CamSoda</span>
                </div>
                <div class="site-btn" onclick="toggleSite(this)">
                    <div class="check-dot"></div><h2 style="color: #ec4899">C</h2><span>Cum4K</span>
                </div>
                <div class="site-btn" style="grid-column: span 2;" onclick="toggleSite(this)">
                    <div class="check-dot"></div><h2 style="color: #a855f7">J</h2><span>Jasmin</span>
                </div>
            </div>
            <button class="btn-main bg-yellow" onclick="startShift()">
                <i data-lucide="play"></i> НАЧАТЬ СМЕНУ
            </button>
        </div>

        <div id="view-active-shift" class="hidden">
            <div class="card" style="text-align: center; border-color: #eab308; box-shadow: 0 0 20px rgba(234, 179, 8, 0.05);">
                <div style="color: #eab308; font-size: 10px; font-weight: 900; letter-spacing: 2px; margin-bottom: 10px; display: flex; align-items: center; justify-content: center; gap: 6px;">
                    <span style="width: 6px; height: 6px; background: #eab308; border-radius: 50%; animation: pulse 1s infinite;"></span> ЭФИР ИДЕТ
                </div>
                <div id="timer" style="font-size: 56px; font-weight: 900; font-family: monospace; letter-spacing: -2px;">00:00:00</div>
            </div>

            <div class="card" style="text-align: center; color: #71717a; font-size: 12px;">
                Не забудьте делать скриншоты каждые 30 минут для отчета.
            </div>

            <button class="btn-main bg-red" onclick="requestFinish()">
                <i data-lucide="square"></i> ЗАКОНЧИТЬ СМЕНУ
            </button>
        </div>
    </div>

    <div id="tab-plan" class="content no-scrollbar">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
            <h2 style="margin: 0; font-size: 20px;">Контент-план</h2>
            <button onclick="addTask()" style="background: #27272a; border: 1px solid #333; color: white; border-radius: 8px; width: 30px; height: 30px; cursor: pointer;">+</button>
        </div>
        <div id="task-list"></div>

        <h2 style="margin: 30px 0 15px; font-size: 20px;">История смен</h2>
        <div id="history-list"></div>
    </div>

    <div id="tab-cabinet" class="content no-scrollbar">
        <div class="card" style="text-align: center; padding: 30px;">
            <div style="width: 80px; height: 80px; background: #eab308; border-radius: 50%; margin: 0 auto 15px; display: flex; align-items: center; justify-content: center; font-size: 32px; color: #000; font-weight: 900;">K</div>
            <h2 style="margin: 0 0 5px;">keikiiiii</h2>
            <span style="color: #eab308; border: 1px solid #eab308; padding: 2px 10px; border-radius: 20px; font-size: 10px; font-weight: bold;">ОПЕРАТОР</span>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
            <div class="card" style="text-align: center; padding: 15px;">
                <div style="font-size: 12px; color: #71717a; margin-bottom: 5px;">Смен</div>
                <div style="font-size: 24px; font-weight: bold;" id="total-shifts">0</div>
            </div>
            <div class="card" style="text-align: center; padding: 15px;">
                <div style="font-size: 12px; color: #71717a; margin-bottom: 5px;">Заработано</div>
                <div style="font-size: 24px; font-weight: bold; color: #4ade80;" id="total-money">$0</div>
            </div>
        </div>

        <h3 style="font-size: 12px; color: #71717a; margin-bottom: 10px; text-transform: uppercase; font-weight: bold;">Учетные записи (Сохраняется)</h3>
        <div id="creds-container">
            </div>
    </div>

    <div id="modal-finish" class="modal-overlay">
        <div class="modal-content">
            <h2 style="margin: 0 0 5px 0;">ИТОГИ СМЕНЫ</h2>
            <p style="font-size: 12px; color: #71717a; margin-bottom: 20px;">Введите заработанные токены</p>
            
            <div style="text-align: left; margin-bottom: 15px;">
                <label style="font-size: 10px; color: #71717a; font-weight: bold;">ТОКЕНЫ (TK)</label>
                <input type="number" id="finish-tk" placeholder="0" oninput="calcFinishUsd()">
            </div>
            
            <div style="text-align: left; margin-bottom: 20px;">
                <label style="font-size: 10px; color: #71717a; font-weight: bold;">ДОХОД ($)</label>
                <input type="text" id="finish-usd" readonly style="background: #222; color: #4ade80; font-weight: bold;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <button onclick="closeModal()" style="background: transparent; border: 1px solid #333; color: #888; padding: 12px; border-radius: 8px; cursor: pointer;">ОТМЕНА</button>
                <button onclick="saveAndStop()" style="background: #eab308; border: none; color: black; font-weight: bold; padding: 12px; border-radius: 8px; cursor: pointer;">СОХРАНИТЬ</button>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <button class="nav-item active" onclick="goTab('tab-studio', this)">
            <i data-lucide="layout-grid"></i> Студия
        </button>
        <button class="nav-item" onclick="goTab('tab-plan', this)">
            <i data-lucide="calendar"></i> План
        </button>
        <button class="nav-item" onclick="goTab('tab-cabinet', this)">
            <i data-lucide="user"></i> Кабинет
        </button>
    </div>

</div>

<script>
    // === ДАННЫЕ И ПЕРЕМЕННЫЕ ===
    let startTime, timerInt;
    
    // Загрузка из памяти телефона
    let shifts = JSON.parse(localStorage.getItem('shifts')) || [];
    let tasks = JSON.parse(localStorage.getItem('tasks')) || ['Проверить свет', 'Настроить OBS'];
    let credentials = JSON.parse(localStorage.getItem('creds')) || {
        'Chaturbate': {l:'', p:''}, 'Stripchat': {l:'', p:''}, 
        'CamSoda': {l:'', p:''}, 'Cum4K': {l:'', p:''}, 'Jasmin': {l:'', p:''}
    };

    // Инициализация при старте
    window.onload = () => {
        lucide.createIcons();
        renderTasks();
        renderHistory();
        renderStats();
        renderCreds();
        
        // Телеграм
        try { window.Telegram.WebApp.ready(); window.Telegram.WebApp.expand(); } catch(e){}
    };

    // === ФУНКЦИОНАЛ СМЕНЫ ===
    function toggleSite(el) { el.classList.toggle('active'); }

    function startShift() {
        document.getElementById('view-pre-shift').classList.add('hidden');
        document.getElementById('view-active-shift').classList.remove('hidden');
        startTime = new Date();
        timerInt = setInterval(() => {
            let diff = new Date(new Date() - startTime);
            document.getElementById('timer').innerText = diff.toISOString().substr(11, 8);
        }, 1000);
    }

    function requestFinish() {
        // Останавливаем таймер ВИЗУАЛЬНО, но не сбрасываем данные пока
        clearInterval(timerInt);
        document.getElementById('modal-finish').classList.add('open');
    }

    function closeModal() {
        document.getElementById('modal-finish').classList.remove('open');
        // Если отменили - таймер должен пойти дальше
        timerInt = setInterval(() => {
            let diff = new Date(new Date() - startTime);
            document.getElementById('timer').innerText = diff.toISOString().substr(11, 8);
        }, 1000);
    }

    function calcFinishUsd() {
        let val = document.getElementById('finish-tk').value;
        document.getElementById('finish-usd').value = (val * 0.05).toFixed(2);
    }

    function saveAndStop() {
        let duration = document.getElementById('timer').innerText;
        let usd = document.getElementById('finish-usd').value || '0';
        let tk = document.getElementById('finish-tk').value || '0';
        
        // Сохранение в историю
        let shift = {
            date: new Date().toLocaleDateString(),
            time: new Date().toLocaleTimeString().slice(0,5),
            duration: duration,
            usd: usd,
            tk: tk
        };
        shifts.unshift(shift);
        localStorage.setItem('shifts', JSON.stringify(shifts));

        // Сброс интерфейса
        document.getElementById('modal-finish').classList.remove('open');
        document.getElementById('view-active-shift').classList.add('hidden');
        document.getElementById('view-pre-shift').classList.remove('hidden');
        document.getElementById('timer').innerText = "00:00:00";
        document.getElementById('finish-tk').value = "";
        
        renderHistory();
        renderStats();
        alert('Смена сохранена!');
    }

    // === ФУНКЦИИ ПЛАНА (ЗАДАЧИ) ===
    function renderTasks() {
        let html = '';
        tasks.forEach((t, i) => {
            html += `
            <div style="background:#1a1a1a; padding:12px; border-radius:8px; border:1px solid #333; margin-bottom:8px; display:flex; justify-content:space-between; align-items:center;">
                <span style="font-size:13px;">${t}</span>
                <button onclick="delTask(${i})" style="background:none; border:none; color:#ef4444; font-weight:bold;">✕</button>
            </div>`;
        });
        document.getElementById('task-list').innerHTML = html;
    }

    function addTask() {
        let t = prompt("Новая задача:");
        if(t) { tasks.push(t); localStorage.setItem('tasks', JSON.stringify(tasks)); renderTasks(); }
    }

    function delTask(i) {
        tasks.splice(i, 1); localStorage.setItem('tasks', JSON.stringify(tasks)); renderTasks();
    }

    function renderHistory() {
        let html = '';
        if(shifts.length === 0) html = '<div style="text-align:center; color:#444; font-size:12px;">Нет завершенных смен</div>';
        shifts.forEach(s => {
            html += `
            <div class="card" style="padding:12px; border-left: 3px solid #eab308; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:bold; font-size:14px;">${s.date} <span style="color:#666; font-size:12px;">${s.time}</span></div>
                    <div style="font-size:11px; color:#888;">Время: ${s.duration}</div>
                </div>
                <div style="text-align:right;">
                    <div style="color:#4ade80; font-weight:900;">$${s.usd}</div>
                    <div style="font-size:10px; color:#666;">${s.tk} tk</div>
                </div>
            </div>`;
        });
        document.getElementById('history-list').innerHTML = html;
    }

    // === ФУНКЦИИ КАБИНЕТА ===
    function renderStats() {
        document.getElementById('total-shifts').innerText = shifts.length;
        let sum = shifts.reduce((acc, curr) => acc + parseFloat(curr.usd), 0);
        document.getElementById('total-money').innerText = '$' + sum.toFixed(2);
        document.getElementById('balance-display').innerText = sum.toFixed(0);
    }

    function renderCreds() {
        let html = '';
        for(let site in credentials) {
            html += `
            <div class="card" style="padding:12px;">
                <div style="font-size:12px; font-weight:bold; color:#eab308; margin-bottom:8px;">${site}</div>
                <input type="text" placeholder="Логин" value="${credentials[site].l}" oninput="saveCred('${site}', 'l', this.value)" style="margin-bottom:8px; font-size:12px;">
                <input type="text" placeholder="Пароль" value="${credentials[site].p}" oninput="saveCred('${site}', 'p', this.value)" style="font-size:12px;">
            </div>`;
        }
        document.getElementById('creds-container').innerHTML = html;
    }

    function saveCred(site, type, val) {
        credentials[site][type] = val;
        localStorage.setItem('creds', JSON.stringify(credentials));
    }

    // === НАВИГАЦИЯ ===
    function goTab(id, btn) {
        document.querySelectorAll('.content').forEach(el => el.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }
</script>

</body>
</html>
